webpackJsonp([0],{11:function(t,e,n){"use strict";function s(t){if(null==t)return"";for(var e;(e=decodeURIComponent(t).replace(r,function(t){return a[t]}))!=t;)t=e;return t}function i(t){for(var e=t+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){var i=n[s].trim();if(0==i.indexOf(e))return decodeURIComponent(i.substring(e.length,i.length))}return null}Object.defineProperty(e,"__esModule",{value:!0}),e.unescapeHTML=s,e.readCookie=i;var a={"&apos;":"'","&#39;":"'","&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"'},r=new RegExp("("+Object.keys(a).join("|")+")","g")},19:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(11);e.default=new function(){function t(){return null!=e||(alert("No connection to the server. Attemping to reconnect..."),l(),!1)}var e,n=this,i={},a={},r=(0,s.readCookie)("session_id"),o=!1,u=!1,l=function t(){if(null==r)return void console.error("Could not find session_id cookie?!");if(!o){o=!0,console.log("Connecting...");var s=new WebSocket("wss://www.roiatalla.com/active-learning/api");s.onopen=function(){e=s,console.log("Connected to server!"),n.send("login",r,function(t,e){t?console.error("Failed to authenticate to API."):console.log("Successfully logged in."),u=!0,n.emit("login",e)})},s.onmessage=function(t){var e=JSON.parse(t.data);if(a[e.id]){var s=a[e.id];s.callback(e.err,e.data,s.request),delete a[e.id]}else e.err||n.emit(e.id,e.data)},s.onclose=function(){e=null,u=!1,o=!1,console.log("Connection closed."),setTimeout(t,1e3)}}};this.isConnected=function(){return null!=e},this.isLoggedIn=function(){return u},this.on=function(t,e){i[t]=i[t]||[],i[t].push(e)},this.once=function(t,e){var s=function t(s){e(s),n.remove(t)};n.on(t,s)},this.remove=function(t,e){var n=i[t].indexOf(e);n>=0&&i[t].splice(n,1)},this.emit=function(t,e){i[t]&&i[t].forEach(function(t){return t(e)})};var c=0;this.send=function(n,s,i){if(!n)return i("Invalid command");if("function"==typeof s&&(i=s,s=void 0),t()){var r={id:c++,command:n,data:s};e.send(JSON.stringify(r)),i&&"function"==typeof i&&(a[r.id]={request:r,callback:i})}else i&&"function"==typeof i&&i("Not connected")},l()}},225:function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),u=n(3),l=s(u),c=n(19),d=s(c),f=n(11),h=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={users:[],selectedUser:null},d.default.isLoggedIn()?n.getUsers():d.default.on("login",n.getUsers.bind(n)),n}return r(e,t),o(e,[{key:"getUsers",value:function(){var t=this;d.default.send("get_users",function(e,n){e?console.error("Error getting users: "+e):t.setState({users:n})})}},{key:"selectUser",value:function(t){this.setState({selectedUser:t})}},{key:"render",value:function(){return l.default.createElement("div",null,l.default.createElement(p,{users:this.state.users,selectUser:this.selectUser.bind(this)}),l.default.createElement(m,{users:this.state.users,selectedUser:this.state.selectedUser}))}}]),e}(l.default.Component);e.default=h;var p=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={showStudents:!0},n}return r(e,t),o(e,[{key:"showStudents",value:function(){this.setState({showStudents:!0})}},{key:"showTAs",value:function(){this.setState({showStudents:!1})}},{key:"render",value:function(){var t=this;return l.default.createElement("div",{className:"panel",id:"student-panel"},l.default.createElement("ul",{className:"tab"},l.default.createElement("li",null,l.default.createElement("a",{href:"#",className:"tablinks"+(this.state.showStudents?" active":""),onClick:this.showStudents.bind(this)},"Students")),l.default.createElement("li",null,l.default.createElement("a",{href:"#",className:"tablinks"+(this.state.showStudents?"":" active"),onClick:this.showTAs.bind(this)},"TAs"))),this.state.showStudents?l.default.createElement("table",{className:"sortable tabcontent",id:"student-list"},l.default.createElement("thead",null,l.default.createElement("tr",null,l.default.createElement("th",null,"Users"))),l.default.createElement("tbody",{id:"student-buttons"},this.props.users.map(function(e){return l.default.createElement("tr",{key:e.username},l.default.createElement("td",null,l.default.createElement("button",{className:"list-button",onClick:function(){return t.props.selectUser(e)}},(0,f.unescapeHTML)(e.username))))}))):l.default.createElement("table",{className:"sortable tabcontent",id:"ta-list"},l.default.createElement("thead",null,l.default.createElement("tr",null,l.default.createElement("th",null,"Teaching Assistants"))),l.default.createElement("tbody",{id:"ta-buttons"})))}}]),e}(l.default.Component),m=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),o(e,[{key:"render",value:function(){return l.default.createElement("div",{className:"panel",id:"permission-panel"},l.default.createElement("p",null,this.props.selectedUser?"Selected "+(0,f.unescapeHTML)(this.props.selectedUser.username)+".":"Select a user from the side panel."),l.default.createElement("p",null,"What else are we going to put here?"),l.default.createElement("button",{id:"make-ta-button"},"Make a TA"))}}]),e}(l.default.Component)},226:function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),u=n(3),l=s(u),c=n(19),d=s(c),f=n(11),h=n(183),p=s(h),m=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={statistics:{},showAllStudents:!0},d.default.isLoggedIn()?n.getStats():d.default.on("login",n.getStats.bind(n)),n}return r(e,t),o(e,[{key:"getStats",value:function(){var t=this;d.default.send("get_stats",function(e,n){e?console.error("Error getting stats: "+e):t.setState({statistics:n})})}},{key:"showStudentStats",value:function(t){this.setState({showStudent:t,showQuiz:null,showAllQuizzes:!1,showAllStudents:!1})}},{key:"showQuizStats",value:function(t){this.setState({showStudent:null,showQuiz:t,showAllQuizzes:!1,showAllStudents:!1})}},{key:"showAllQuizStats",value:function(){this.setState({showStudent:null,showQuiz:null,showAllQuizzes:!0,showAllStudents:!1})}},{key:"showAllStudentStats",value:function(){this.setState({showStudent:null,showQuiz:null,showAllQuizzes:!1,showAllStudents:!0})}},{key:"render",value:function(){return l.default.createElement("div",null,l.default.createElement(v,{showStudentStats:this.showStudentStats.bind(this),showQuizStats:this.showQuizStats.bind(this),showAllQuizStats:this.showAllQuizStats.bind(this),showAllStudentStats:this.showAllStudentStats.bind(this),statistics:this.state.statistics}),l.default.createElement(b,{showStudent:this.state.showStudent,showQuiz:this.state.showQuiz,showAllQuizzes:this.state.showAllQuizzes,showAllStudents:this.state.showAllStudents,statistics:this.state.statistics}))}}]),e}(l.default.Component);e.default=m;var v=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={showStudents:!0},n}return r(e,t),o(e,[{key:"showStudents",value:function(){this.setState({showStudents:!0}),this.props.showAllStudentStats()}},{key:"showQuizzes",value:function(){this.setState({showStudents:!1}),this.props.showAllQuizStats()}},{key:"getAllQuizNames",value:function(){var t=this.props.statistics,e=[];for(var n in t)for(var s in t[n]){var i=t[n][s].name;e.indexOf(i)==-1&&e.push(i)}return e}},{key:"render",value:function(){var t=this;return l.default.createElement("div",{className:"panel",id:"student-panel"},l.default.createElement("ul",{className:"tab"},l.default.createElement("li",null,l.default.createElement("a",{href:"#",className:"tablinks"+(this.state.showStudents?" active":""),onClick:this.showStudents.bind(this)},"Students")),l.default.createElement("li",null,l.default.createElement("a",{href:"#",className:"tablinks"+(this.state.showStudents?"":" active"),onClick:this.showQuizzes.bind(this)},"Quizzes"))),this.state.showStudents?l.default.createElement("table",{className:"sortable tabcontent",id:"student-list"},l.default.createElement("thead",null,l.default.createElement("tr",null,l.default.createElement("th",null,"Students"))),l.default.createElement("tbody",{id:"student-buttons"},Object.keys(this.props.statistics).map(function(e){return l.default.createElement("tr",{key:e},l.default.createElement("td",null,l.default.createElement("button",{className:"list-button",onClick:function(){return t.props.showStudentStats(e)}},e)))}))):l.default.createElement("table",{className:"sortable tabcontent",id:"quiz-list"},l.default.createElement("thead",null,l.default.createElement("tr",null,l.default.createElement("th",null,"Quizzes"))),l.default.createElement("tbody",{id:"quiz-buttons"},this.getAllQuizNames().map(function(e,n){return l.default.createElement("tr",{key:n+"-"+e},l.default.createElement("td",null,l.default.createElement("button",{className:"list-button",onClick:function(){return t.props.showQuizStats(e)}},e)))}))))}}]),e}(l.default.Component),b=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),o(e,[{key:"createChart",value:function(t,e){return new p.default(document.getElementById("statistics-chart"),{type:"bar",data:t,options:{maintainAspectRatio:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,max:100}}],xAxes:[{display:e}]}}})}},{key:"displayStudentStatistics",value:function(t){var e=this.props.statistics,n=[],s=[];for(var i in e[t]){var a=0,r=0;for(var o in e[t][i].questions){var u=e[t][i].questions[o];a+=u.score,r+=u.total}n.push((0,f.unescapeHTML)(e[t][i].name)),s.push(100*(a/r))}var l={labels:n,datasets:[{label:"% correct answers",data:s,backgroundColor:"rgba(100, 129, 237, 0.5)",borderColor:"rgba(200, 200, 200, 1)",borderWidth:2}]};this.chart&&this.chart.destroy(),this.chart=this.createChart(l,!0)}},{key:"displayQuizStatistics",value:function(t){var e=this.props.statistics,n={};for(var s in e)for(var i in e[s])if(e[s][i].name==t)for(var a in e[s][i].questions){var r=0,o=0,u=0,l=0,c=0,d=0,h=e[s][i].questions[a].name,p=e[s][i].questions[a];null!=n[h]&&(r=n[h].score,o=n[h].total,u=n[h].A,l=n[h].B,c=n[h].C,d=n[h].D),0==p.answer&&(u+=p.total),1==p.answer&&(l+=p.total),2==p.answer&&(c+=p.total),3==p.answer&&(d+=p.total),n[h]={score:r+p.score,total:o+p.total,A:u,B:l,C:c,D:d}}var m=[],v=[];for(p in n){var b=(0,f.unescapeHTML)(p),g=(100*(n[p].A/n[p].total)).toFixed(2),y=(100*(n[p].B/n[p].total)).toFixed(2),w=(100*(n[p].C/n[p].total)).toFixed(2),E=(100*(n[p].D/n[p].total)).toFixed(2);g>0&&(b+=" A: "+g+"%"),y>0&&(b+=" B: "+y+"%"),w>0&&(b+=" C: "+w+"%"),E>0&&(b+=" D: "+E+"%"),m.push(b),v.push(100*(n[p].score/n[p].total))}var k={labels:m,datasets:[{label:"% correct answers",data:v,backgroundColor:"rgba(100, 129, 237, 0.5)",borderColor:"rgba(200, 200, 200, 1)",borderWidth:2}]};this.chart&&this.chart.destroy(),this.chart=this.createChart(k,!1)}},{key:"displayAllQuizStatistics",value:function(){var t=this.props.statistics,e={};for(var n in t)for(var s in t[n]){var i=t[n][s].name,a=0,r=0;for(var o in t[n][s].questions){var u=t[n][s].questions[o];a+=u.score,r+=u.total}null!=e[i]?(e[i].score+=a,e[i].total+=r):e[i]={score:a,total:r}}var l=[],c=[];for(var i in e)l.push((0,f.unescapeHTML)(i)),c.push(100*(e[i].score/e[i].total));var d={labels:l,datasets:[{label:"% correct answers",data:c,backgroundColor:"rgba(100, 129, 237, 0.5)",borderColor:"rgba(200, 200, 200, 1)",borderWidth:2}]};this.chart&&this.chart.destroy(),this.chart=this.createChart(d,!0)}},{key:"displayAllStudentStatistics",value:function(){var t=this.props.statistics,e=[],n=[];for(var s in t){var i=0,a=0;for(var r in t[s]){var o=0,u=0;for(var l in t[s][r].questions){var c=t[s][r].questions[l];o+=c.score,u+=c.total}i+=100*(o/u),a++}e.push((0,f.unescapeHTML)(s)),n.push(i/=a)}var d={labels:e,datasets:[{label:"% grade overall",data:n,backgroundColor:"rgba(100, 129, 237, 0.5)",borderColor:"rgba(200, 200, 200, 1)",borderWidth:2}]};this.chart&&this.chart.destroy(),this.chart=this.createChart(d,!0)}},{key:"setupChart",value:function(t){this.canvas=this.canvas||t,this.props.showStudent?this.displayStudentStatistics(this.props.showStudent):this.props.showQuiz?this.displayQuizStatistics(this.props.showQuiz):this.props.showAllQuizzes?this.displayAllQuizStatistics():this.displayAllStudentStatistics()}},{key:"render",value:function(){return l.default.createElement("div",{id:"statistics-panel"},l.default.createElement("canvas",{ref:this.setupChart.bind(this),id:"statistics-chart"}))}}]),e}(l.default.Component)},391:function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),l=n(3),c=s(l),d=n(20),f=s(d),h=n(19),p=s(h),m=n(11),v=n(226),b=s(v),g=n(225),y=s(g),w=n(45);window.onload=function(){p.default.on("login",function(t){t&&(p.default.send("get_quizzes",function(t,e){return!t&&p.default.emit("quizzes",e)}),p.default.send("get_questions",function(t,e){return!t&&p.default.emit("questions",e)}))}),f.default.render(c.default.createElement(w.Router,{history:w.browserHistory},c.default.createElement(w.Route,{path:"/active-learning/",component:E},c.default.createElement(w.IndexRoute,{component:q}),c.default.createElement(w.Route,{path:"/active-learning/statistics",component:b.default}),c.default.createElement(w.Route,{path:"/active-learning/settings",component:y.default}))),document.getElementById("panels"))};var E=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={questions:{},quizzes:{},showConfirm:null,currentLiveQuiz:null},p.default.on("login",function(t){t&&n.setState({user:t})}),p.default.on("questions",function(t){return n.setState({questions:t})}),p.default.on("quizzes",function(t){return n.setState({quizzes:t})}),n}return r(e,t),u(e,[{key:"presentLive",value:function(t){this.setState({currentLiveQuiz:this.state.quizzes[t]})}},{key:"hideLiveQuiz",value:function(){this.setState({currentLiveQuiz:null})}},{key:"showConfirm",value:function(t){this.setState({showConfirm:t})}},{key:"hideConfirm",value:function(){this.setState({showConfirm:null})}},{key:"render",value:function(){var t=this;return c.default.createElement("div",null,(this.state.currentLiveQuiz||this.state.showConfirm)&&c.default.createElement("div",{id:"overlay"}),this.state.currentLiveQuiz&&c.default.createElement(S,{quiz:this.state.currentLiveQuiz,questions:this.state.questions,hideLiveQuiz:this.hideLiveQuiz.bind(this)}),this.state.showConfirm&&c.default.createElement(z,o({hide:function(){return t.hideConfirm()}},this.state.showConfirm)),c.default.createElement("div",{className:(this.state.currentLiveQuiz||this.state.showConfirm)&&"blur"},c.default.createElement(k,{user:this.state.user,page:this.state.page}),c.default.Children.map(this.props.children,function(e){return c.default.cloneElement(e,{user:t.state.user,showConfirm:t.showConfirm.bind(t),questions:t.state.questions,quizzes:t.state.quizzes,presentLive:t.presentLive.bind(t)})})))}}]),e}(c.default.Component),k=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"render",value:function(){return c.default.createElement("div",{id:"header-panel"},c.default.createElement("img",{id:"logo",src:"images/active_learning_logo_white.png",width:"175",height:"75",alt:"logo"}),c.default.createElement("h2",{id:"name"},this.props.user?this.props.user.username:""),c.default.createElement("nav",null,c.default.createElement("form",{method:"post"},c.default.createElement("button",{className:"header-nav-link",formAction:"api/logout"},"Logout")),c.default.createElement(w.IndexLink,{to:"/active-learning/settings",className:"header-nav-link",activeClassName:"selected"},"Settings"),c.default.createElement(w.IndexLink,{to:"/active-learning/statistics",className:"header-nav-link",activeClassName:"selected"},"Statistics"),c.default.createElement(w.IndexLink,{to:"/active-learning/",className:"header-nav-link",activeClassName:"selected"},"Home")))}}]),e}(c.default.Component),S=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={currentLiveQuestion:null,onLoginFunc:function(t){null!=n.state.currentLiveQuestion&&p.default.send("broadcast_live_question",n.state.currentLiveQuestion)}},p.default.on("login",n.state.onLoginFunc),n}return r(e,t),u(e,[{key:"componentWillUnmount",value:function(){p.default.remove("login",this.state.onLoginFunc),p.default.send("end_live_question")}},{key:"presentLiveQuestion",value:function(t){this.setState({currentLiveQuestion:t}),p.default.send("broadcast_live_question",t)}},{key:"render",value:function(){var t=this;return c.default.createElement("div",{id:"live-quiz"},c.default.createElement("ol",{id:"live-questions-list"},this.props.quiz.questions.map(function(e){return c.default.createElement(j,{key:e,question:t.props.questions[e]},c.default.createElement("button",{className:"presenting-live-button"+(e==t.state.currentLiveQuestion?" presenting-live-button-selected":""),onClick:function(){return t.presentLiveQuestion(e)}},"L"))})),c.default.createElement("button",{onClick:this.props.hideLiveQuiz,className:"delete-button"},"✖"))}}]),e}(c.default.Component),z=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"clicked",value:function(t){this.props.hide(),this.props.onAction&&this.props.onAction(t)}},{key:"render",value:function(){var t=this;return c.default.createElement("div",{id:"confirm-box"},c.default.createElement("p",{id:"confirm-msg"},this.props.title),"yesno"==this.props.type?c.default.createElement("div",null,c.default.createElement("button",{onClick:function(){return t.clicked(!1)},className:"cancel-button"},this.props.noText||"No"),c.default.createElement("button",{onClick:function(){return t.clicked(!0)},className:"confirm-button"},this.props.yesText||"Yes")):c.default.createElement("button",{onClick:function(){return t.clicked()},id:"ok-button"},this.props.okText||"Ok"))}}]),e}(c.default.Component),q=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"render",value:function(){return c.default.createElement("div",null,c.default.createElement(C,{showConfirm:this.props.showConfirm,questions:this.props.questions,quizzes:this.props.quizzes,presentLive:this.props.presentLive}),c.default.createElement(N,{showConfirm:this.props.showConfirm,questions:this.props.questions}))}}]),e}(c.default.Component),C=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={editQuiz:null},n}return r(e,t),u(e,[{key:"chooseQuiz",value:function(t){this.setState({editQuiz:this.props.quizzes[t]})}},{key:"toggleQuizEditor",value:function(){this.setState(function(t){return{editQuiz:t.editQuiz?null:{}}})}},{key:"hideQuizEditor",value:function(){this.setState({editQuiz:null})}},{key:"render",value:function(){var t=this;return c.default.createElement("div",{id:"quiz-panel"},c.default.createElement("button",{className:"option-button",onClick:function(){return t.toggleQuizEditor()}},this.state.editQuiz?"Cancel":"Create Quiz"),this.state.editQuiz?c.default.createElement(_,{quiz:this.state.editQuiz,questions:this.props.questions,hideQuizEditor:this.hideQuizEditor.bind(this),showConfirm:this.props.showConfirm}):c.default.createElement(Q,{showConfirm:this.props.showConfirm,quizzes:this.props.quizzes,chooseQuiz:this.chooseQuiz.bind(this),presentLive:this.props.presentLive}))}}]),e}(c.default.Component),_=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={id:t.quiz.id,name:t.quiz.name||"",questions:t.quiz.questions||[]},n.questionsDOM={},n}return r(e,t),u(e,[{key:"onNameChange",value:function(t){this.setState({name:t.target.value})}},{key:"submitQuiz",value:function(){var t=this,e=function(e){e?t.props.showConfirm({type:"ok",title:e}):t.props.hideQuizEditor()};this.state.id?p.default.send("update_quiz",{id:this.state.id,name:this.state.name,questions:this.state.questions},e):p.default.send("create_quiz",{name:this.state.name,questions:this.state.questions},e)}},{key:"removeQuestion",value:function(t){this.setState(function(e){var n=e.questions.slice(),s=n.indexOf(t);return s!=-1?(n.splice(s,1),{questions:n}):{}})}},{key:"onDragStart",value:function(t,e){e.dataTransfer.setData("question-id",t)}},{key:"getDropTargetId",value:function(t){for(var e=t.target;e&&(!e.dataset||!e.dataset.id);)e=e.parentNode;return e&&e.dataset.id}},{key:"onDrop",value:function(t){this.setState({dragOverId:null}),t.preventDefault();var e=t.dataTransfer.getData("question-id");if(e){var n=this.getDropTargetId(t);this.setState(function(t){var s=t.questions.slice();if(n){if(e!=n){var i=s.indexOf(e),a=s.indexOf(n);i!=-1&&s.splice(i,1),a!=-1?s.splice(a,0,e):s.push(e)}}else{var i=s.indexOf(e);i!=-1&&s.splice(i,1),s.push(e)}return{questions:s}})}}},{key:"onDragOver",value:function(t){t.preventDefault();var e=this.getDropTargetId(t);e!=this.state.dragOverId&&this.setState({dragOverId:e})}},{key:"render",value:function(){var t=this;return c.default.createElement("div",{id:"quiz-creator"},c.default.createElement("div",{id:"quiz-creator-header"},c.default.createElement("div",{id:"quiz-name"},"Name: ",c.default.createElement("input",{type:"text",id:"quiz-name-field",value:this.state.name,onChange:this.onNameChange.bind(this)})),c.default.createElement("div",{id:"submit-quiz"},c.default.createElement("button",{id:"submit-quiz-button",onClick:this.submitQuiz.bind(this)},this.state.id?"Update":"Submit"))),c.default.createElement("ol",{id:"quiz-question-list",onDrop:this.onDrop.bind(this),onDragOver:this.onDragOver.bind(this)},this.state.questions.length>0?[this.state.questions.map(function(e){return c.default.createElement(j,{key:e,question:t.props.questions[e],draggable:!0,onDragStart:t.onDragStart.bind(t,e),draggedOver:t.state.dragOverId==e},c.default.createElement("button",{className:"delete-button",onClick:function(){return t.removeQuestion(e)}},"✖"))}),c.default.createElement("li",{key:"hidden",style:{visibility:"hidden",height:"100px"}})]:c.default.createElement("li",{style:{listStyleType:"none",textAlign:"center"}},"Drag questions here!")))}}]),e}(c.default.Component),Q=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"render",value:function(){var t=this;return c.default.createElement("ol",{className:"quiz-list"},Object.keys(this.props.quizzes).map(function(e){var n=t.props.quizzes[e];return c.default.createElement(O,{key:e,quiz:n,chooseQuiz:function(){return t.props.chooseQuiz(e)},presentLive:function(){return t.props.presentLive(e)},showConfirm:t.props.showConfirm})}))}}]),e}(c.default.Component),O=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"deleteQuiz",value:function(){var t=this;this.props.showConfirm({type:"yesno",title:"Are you sure you want to delete this quiz?",onAction:function(e){e&&p.default.send("delete_quiz",t.props.quiz.id,function(e,n){e&&t.props.showConfirm({type:"ok",title:e})})}})}},{key:"render",value:function(){return c.default.createElement("li",{className:"quiz"},c.default.createElement("button",{className:"quiz-body",onClick:this.props.chooseQuiz},(0,m.unescapeHTML)(this.props.quiz.name)),c.default.createElement("button",{className:"delete-button",onClick:this.deleteQuiz.bind(this)},"✖"),c.default.createElement("button",{className:"live-button",onClick:this.props.presentLive},"L"))}}]),e}(c.default.Component),N=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={editQuestion:null},n}return r(e,t),u(e,[{key:"chooseQuestion",value:function(t){this.setState({editQuestion:this.props.questions[t]})}},{key:"toggleQuestionEditor",value:function(){this.setState(function(t){return{editQuestion:t.editQuestion?null:{}}})}},{key:"hideQuestionEditor",value:function(){this.setState({editQuestion:null})}},{key:"render",value:function(){return c.default.createElement("div",{id:"question-panel"},c.default.createElement("button",{className:"option-button",onClick:this.toggleQuestionEditor.bind(this)},this.state.editQuestion?"Cancel":"Create Question"),this.state.editQuestion?c.default.createElement(A,{question:this.state.editQuestion,hideQuestionEditor:this.hideQuestionEditor.bind(this),showConfirm:this.props.showConfirm}):c.default.createElement(L,{questions:this.props.questions,chooseQuestion:this.chooseQuestion.bind(this),showConfirm:this.props.showConfirm}))}}]),e}(c.default.Component),A=function(t){function e(t){i(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={id:t.question.id,title:t.question.name||"",answers:t.question.answers||["","","",""],correct:t.question.correct||null,image:t.question.image||null},n}return r(e,t),u(e,[{key:"changeTitle",value:function(t){this.setState({title:t.target.value})}},{key:"changeAnswer",value:function(t,e){var n=e.target.value;this.setState(function(e){var s=e.answers.slice();return s[t]=String(n),{answers:s}})}},{key:"addAnswer",value:function(){this.setState(function(t){var e=t.answers.slice();return e.push(""),{answers:e}})}},{key:"removeAnswer",value:function(t){return 2==this.state.answers.length?void this.props.showConfirm({type:"ok",title:"You must have at least 2 answer fields."}):void this.setState(function(e){var n=e.answers.slice();return n.splice(t,1),{answers:n}})}},{key:"correctSelected",value:function(t){this.setState({correct:t})}},{key:"imageSelected",value:function(t){var e=this;if(t.target.files&&t.target.files[0]){var n=new FileReader;n.onload=function(t){var n=t.target.result;n.startsWith("data:image")?e.setState({image:n}):e.props.showConfirm({type:"ok",title:"Invalid image file"})},n.readAsDataURL(t.target.files[0])}else this.setState({image:null})}},{key:"clearImage",value:function(){this.setState({image:null})}},{key:"submitQuestion",value:function(){var t=this,e=this.state.title.trim();if(!e)return void this.props.showConfirm({type:"ok",title:"Question title cannot be empty."});var n=this.state.answers.map(function(t){return t.trim()});if(n.findIndex(function(t){return!t})!=-1)return void this.props.showConfirm({type:"ok",title:"Cannot have a blank answer field."});var s=function(e){e?t.props.showConfirm({type:"ok",title:"Error submitting question: "+e}):t.props.hideQuestionEditor()};this.state.id?p.default.send("update_question",{id:this.state.id,name:this.state.title,answers:n,correct:String(this.state.correct),image:this.state.image||void 0},s):p.default.send("create_question",{name:this.state.title,answers:n,correct:String(this.state.correct),image:this.state.image||void 0},s)}},{key:"render",value:function(){var t=this;return c.default.createElement("div",{id:"question-creator"},c.default.createElement("label",{className:"question-creator-row"},c.default.createElement("span",{className:"question-creator-title"},"Question: "),c.default.createElement("input",{type:"text",value:this.state.title,size:"75",onChange:this.changeTitle.bind(this)})),c.default.createElement("ol",{className:"answer-list"},this.state.answers.map(function(e,n){return c.default.createElement("li",{key:n,className:"answer"},c.default.createElement("input",{type:"text",value:e,size:"35",onChange:t.changeAnswer.bind(t,n)}),c.default.createElement("input",{type:"radio",name:"correct",checked:t.state.correct==n,onChange:t.correctSelected.bind(t,n)}),"Correct",c.default.createElement("button",{className:"remove-answer-button",onClick:t.removeAnswer.bind(t,n)},"✖"))})),c.default.createElement("div",{className:"question-creator-row"},c.default.createElement("button",{onClick:this.addAnswer.bind(this)},"Add answer")),c.default.createElement("div",{className:"question-creator-row"},c.default.createElement("input",{type:"file",onChange:this.imageSelected.bind(this)}),this.state.image&&c.default.createElement("input",{className:"option-button",type:"button",value:"Clear image",onClick:this.clearImage.bind(this)})),this.state.image&&c.default.createElement("div",{className:"question-creator-row"},c.default.createElement("img",{id:"image-input",src:this.state.image})),c.default.createElement("div",{className:"question-creator-row"},c.default.createElement("button",{className:"option-button",onClick:this.submitQuestion.bind(this)},this.state.id?"Update":"Submit")))}}]),e}(c.default.Component),L=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"deleteQuestion",value:function(t){var e=this;this.props.showConfirm({type:"yesno",title:"Are you sure you want to delete this question?",onAction:function(n){n&&p.default.send("delete_question",t,function(t,n){t&&e.props.showConfirm({type:"ok",title:t})})}})}},{key:"onDragStart",value:function(t,e){e.dataTransfer.setData("question-id",t)}},{key:"render",value:function(){var t=this;return c.default.createElement("ul",{id:"question-list"},Object.keys(this.props.questions).map(function(e){
return c.default.createElement(j,{key:e,question:t.props.questions[e],draggable:!0,onDragStart:t.onDragStart.bind(t,e)},c.default.createElement("button",{className:"delete-button",onClick:function(){return t.deleteQuestion(e)}},"✖"),c.default.createElement("button",{className:"edit-button",onClick:function(){return t.props.chooseQuestion(e)}},"E"))}))}}]),e}(c.default.Component),j=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),u(e,[{key:"render",value:function(){var t=this;return this.props.question?c.default.createElement("li",{"data-id":this.props.question.id,className:"question"+(this.props.draggable?" draggable":"")+(this.props.draggedOver?" drag-over":""),draggable:this.props.draggable,onDragStart:this.props.onDragStart},c.default.createElement("div",{className:"question-body",style:this.props.question.image?{width:"70%"}:{}},c.default.createElement("p",{className:"question-name"},(0,m.unescapeHTML)(this.props.question.name)),c.default.createElement("ol",{className:"answer-list"},this.props.question.answers.map(function(e,n){return c.default.createElement("li",{key:e+n,className:"answer"},c.default.createElement("input",{type:"radio",value:n,readOnly:!0,checked:t.props.question.correct==n}),(0,m.unescapeHTML)(e))}))),this.props.question.image&&c.default.createElement("img",{className:"question-image",src:this.props.question.image}),this.props.children):null}}]),e}(c.default.Component)}},[391]);